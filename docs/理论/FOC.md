# FOC 算法——无刷电机原理与控制

## 一、无刷电机结构分类

从宏观上看，电机可分为定子和转子两部分。定子是有线圈绕组且固定不动的部分，转子则是电机旋转并输出转动和扭矩的部分。

进一步细分，无刷电机分为内转子和外转子两种。内转子无刷电机的转子在内部，而外转子无刷电机的转子在外面，常见的航模无刷电机就是外转子无刷电机。

## 二、直流无刷电机驱动原理

直流无刷电机依靠改变电机定子线圈的电流交变频率和波形，在定子周围形成磁场，驱动转子永磁体转动，从而带动电机旋转。所以，研究改变定子线圈电流交变频率和波形是驱动电机的关键。

## 三、硬件控制原理

无刷电机与有刷电机的区别在于无刷电机没有电刷，不能像有刷电机那样通过机械结构进行电流换向，而是要通过 MOS 等器件实现电子换向。MOS 可看作是控制电流通断的开关，类似水龙头控制水流。

通过控制不同 MOS 管的通断组合，可改变电机线圈电流大小和方向。例如，打开 Q1 管和 Q2 管，电流从 A 相流到 B 相再到负极，根据右手螺旋定则产生磁场，定子线圈吸引转子磁铁转动，但转子旋转一定角度后会停止。此时打开 Q1 管和 Q4 管，磁场方向改变，转子磁极进一步旋转。交替开关不同 MOS 管，可实现电机磁极交替运动，这就是无刷电机旋转运动原理。因此，电机控制实际上是对 MOS 管开关规律的控制，而这需要单片机程序控制，由此引出 FOC 控制算法，它是对电机运动模型抽象简化，进而有规律控制 MOS 管开关通断的过程。

## 四、软件控制原理

### 克拉克变换

交替开关 MOS 管使电机转动，这些 MOS 管快速周期性开关，观察各相可得到 A、B、C 三相电流随时间变化的曲线，它们相位差为 120°。从另一个角度看，控制这个相位差为 120° 的正弦状波形就能实现电机控制。

克拉克变换是实现波形控制的第一步。克拉克变换以美国第一位专业电气女工程师伊迪丝・克拉克命名，她在电气工程领域有诸多开创性成就。

控制 120° 的正弦状波形实现电机控制有难度，因为相之间相互耦合，改变一相无法实现控制，必须三相同时改变，问题复杂。克拉克变换就是降维解耦过程，把三相相位差 120° 的电机波形降维为两维矢量。其思路是先将三相电流波形抽象化为三个间隔 120° 的矢量，再利用三角函数将矢量降维到两个坐标轴，将复杂三相问题转化为 α - β 坐标轴上的数值变化问题。

### 克拉克逆变换

对于 FOC 算法，三相电压矢量方面，无刷电机的电流矢量乘上相电阻 R 就变成电压矢量，电流矢量和电压矢量只是幅值不同。在电流矢量情况下的克拉克变换和帕克变换，与电压矢量情况下的推导过程一致，只是符号不同。代码编写中常用电压形式的公式，因为硬件电路控制电流比控制电压难，常见无刷电机控制芯片和电路只接受 ua、ub、uc 电压控制信号，控制 ia、ib、ic 需要在控制 ua、ub、uc 的基础上通过电流传感器作闭环控制。

### 帕克变换



## 五、FOC 代码实现

包括 FOC 开环速度、FOC 闭环位置、FOC 闭环速度和 FOC 电流闭环等方面，但文中未详细展开介绍这些内容的实现细节。
